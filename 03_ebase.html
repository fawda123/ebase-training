<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Using EBASE – Ecosystem Metabolism Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04_interpret.html" rel="next">
<link href="./02_dataprep.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="libs/style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_intro.html">Lessons</a></li><li class="breadcrumb-item"><a href="./03_ebase.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Using EBASE</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Ecosystem Metabolism Workshop</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/fawda123/ebase-training" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Lessons</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Inroduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_dataprep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_ebase.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Using EBASE</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_interpret.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Interpreting Results</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Setup for the workshop</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#lesson-outline" id="toc-lesson-outline" class="nav-link active" data-scroll-target="#lesson-outline"><span class="header-section-number">3.1</span> Lesson Outline</a></li>
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link" data-scroll-target="#learning-goals"><span class="header-section-number">3.2</span> Learning Goals</a></li>
  <li><a href="#the-ebase-method" id="toc-the-ebase-method" class="nav-link" data-scroll-target="#the-ebase-method"><span class="header-section-number">3.3</span> The EBASE method</a></li>
  <li><a href="#the-bayesian-approach" id="toc-the-bayesian-approach" class="nav-link" data-scroll-target="#the-bayesian-approach"><span class="header-section-number">3.4</span> The Bayesian approach</a></li>
  <li><a href="#ebase-minimal-example" id="toc-ebase-minimal-example" class="nav-link" data-scroll-target="#ebase-minimal-example"><span class="header-section-number">3.5</span> EBASE minimal example</a></li>
  <li><a href="#ebase-full-example" id="toc-ebase-full-example" class="nav-link" data-scroll-target="#ebase-full-example"><span class="header-section-number">3.6</span> EBASE full example</a></li>
  <li><a href="#assess-model-fit" id="toc-assess-model-fit" class="nav-link" data-scroll-target="#assess-model-fit"><span class="header-section-number">3.7</span> Assess model fit</a></li>
  <li><a href="#using-ebase-with-long-time-series" id="toc-using-ebase-with-long-time-series" class="nav-link" data-scroll-target="#using-ebase-with-long-time-series"><span class="header-section-number">3.8</span> Using EBASE with long time series</a></li>
  <li><a href="#sec-optimization" id="toc-sec-optimization" class="nav-link" data-scroll-target="#sec-optimization"><span class="header-section-number">3.9</span> Equation optimization length</a></li>
  <li><a href="#starting-value" id="toc-starting-value" class="nav-link" data-scroll-target="#starting-value"><span class="header-section-number">3.10</span> Starting value</a></li>
  <li><a href="#sec-missing" id="toc-sec-missing" class="nav-link" data-scroll-target="#sec-missing"><span class="header-section-number">3.11</span> Missing values</a></li>
  <li><a href="#changing-priors" id="toc-changing-priors" class="nav-link" data-scroll-target="#changing-priors"><span class="header-section-number">3.12</span> Changing priors</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">3.13</span> Next steps</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/fawda123/ebase-training/edit/main/03_ebase.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_intro.html">Lessons</a></li><li class="breadcrumb-item"><a href="./03_ebase.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Using EBASE</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-ebase" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Using EBASE</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/fawda123/ebase-training/blob/main/03_ebase.qmd"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="lesson-outline" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="lesson-outline"><span class="header-section-number">3.1</span> Lesson Outline</h2>
<p>This lesson will explain the basic theory behind ecosystem metabolism and how EBASE is used to estimate key parameters. EBASE is a Bayesian implementation for estimating metabolism that differs from more conventional approaches. We’ll also explore the main functions of EBASE to estimate metabolism, how the Bayesian approach can be used to incorporate prior knowledge, and interpret the results.</p>
</section>
<section id="learning-goals" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="learning-goals"><span class="header-section-number">3.2</span> Learning Goals</h2>
<ul>
<li>Understand the basic theories of EBASE</li>
<li>Understand the Bayesian approach to estimating metabolism</li>
<li>Learn how EBASE is used to estimate key parameters</li>
<li>Use the main functions of EBASE to estimate metabolism</li>
<li>Interpret the results of EBASE</li>
</ul>
</section>
<section id="the-ebase-method" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="the-ebase-method"><span class="header-section-number">3.3</span> The EBASE method</h2>
<p><a href="01_intro.html" class="quarto-xref">Lesson&nbsp;<span>1</span></a> provided a general description of ecosystem metabolism and why it’s an important measure of ecosystem health. The EBASE approach follows these general principles but differs in the core model for estimating production, respiration, and gas exchange and the statistical approach for how the parameters for each are estimated. Let’s revisit the core metabolic equation:</p>
<p><span class="math display">\[
NEM = P - R
\]</span></p>
<p>Net ecosystem metabolism (<span class="math inline">\(NEM\)</span>) is simply the difference between processes that produce organic matter (production or <span class="math inline">\(P\)</span>) and those that consume organic matter (respiration or <span class="math inline">\(R\)</span>).</p>
<p>We can estimate these rates from the dissolved oxygen (<span class="math inline">\(DO\)</span>) time series by using the rate of change of <span class="math inline">\(DO\)</span> per unit time and accounting for gas exchange <span class="math inline">\(D\)</span>. Water column depth (<span class="math inline">\(Z\)</span>) is used to estimate metabolism as an areal rate.</p>
<p><span class="math display">\[
Z\frac{dC_d}{dt} = P - R + D
\]</span></p>
<p>Methods for estimating metabolism from the dissolved oxygen time series vary in how each of the key parameters are modeled. The core equation for EBASE is the same as the previous but expanded using methods for estuarine applications:</p>
<p><span class="math display">\[
Z\frac{dC_d}{dt} = aPAR - R + bU_{10}^2\left(\frac{Sc}{600} \right)^{-0.5} \left(C_{Sat} - C_d \right )
\]</span></p>
<p><span class="math inline">\(aPAR\)</span> is production (<span class="math inline">\(P\)</span>), <span class="math inline">\(R\)</span> is respiration, and the last term is gas exchange <span class="citation" data-cites="Wanninkhof14">(<span class="math inline">\(D\)</span>, <a href="references.html#ref-Wanninkhof14" role="doc-biblioref">Wanninkhof 2014</a>)</span>. The required input data to fit this model was described in <a href="02_dataprep.html" class="quarto-xref">Lesson&nbsp;<span>2</span></a>. Three of these inputs are used directly in the equation as <span class="math inline">\(C_d\)</span> for dissolved oxygen, <span class="math inline">\(PAR\)</span>, and wind speed as <span class="math inline">\(U_{10}^2\)</span> (or squared wind speed at ten meters above the surface). The other terms are the Schmidt number (<span class="math inline">\(S_c\)</span>) and dissolved oxygen at saturation (<span class="math inline">\(C_{sat}\)</span>), both of which are calculated from water temperature and salinity in the input data.</p>
<p>The remaining terms <span class="math inline">\(a\)</span>, <span class="math inline">\(R\)</span>, and <span class="math inline">\(b\)</span> are estimated during the model fitting process, which we’ll discuss in the next section. All three provide important information about metabolic processes and are useful on their own to understand ecosystem function.</p>
<ul>
<li><span class="math inline">\(a\)</span>: The light efficiency parameter as <span class="math inline">\(\left(mmol~O_2~m^{-2}~d^{-1}\right) / \left(W~m^{-2}\right)\)</span>, yields production when multiplied by <span class="math inline">\(PAR\)</span>. This is a measure of how efficiently light is converted to organic matter. It provides similar information as a P/I curve by showing how production changes with light availability.</li>
<li><span class="math inline">\(R\)</span>: The respiration rate as <span class="math inline">\(mmol~O_2~m^{-2}~d^{-1}\)</span>, is the rate at which organic matter is consumed.</li>
<li><span class="math inline">\(b\)</span>: The sensitivity of gas exchange to wind speed as <span class="math inline">\(\left(cm~h^{-1}\right) / \left(m^2~s^{-2}\right)\)</span>.</li>
</ul>
<p>Although the core model equation may seem complicated, its formulation was chosen to describe dominant processes that influence metabolism in an estuarine setting. The details for this justification can be found in <span class="citation" data-cites="Beck2024">Beck et al. (<a href="references.html#ref-Beck2024" role="doc-biblioref">2024</a>)</span>.</p>
</section>
<section id="the-bayesian-approach" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="the-bayesian-approach"><span class="header-section-number">3.4</span> The Bayesian approach</h2>
<p>Both the open-water method presented by <span class="citation" data-cites="Odum56">Odum (<a href="references.html#ref-Odum56" role="doc-biblioref">1956</a>)</span> and EBASE similarly use the rate of change of <span class="math inline">\(DO\)</span> to estimate metabolism. However, the Bayesian approach used in EBASE differs in how the parameters are estimated and has several key advantages.</p>
<p>Modern statistical approaches to modelling can broadly be described as conventional “frequentist” methods or Bayesian. The former describes standard and more commonly used methods where a model is fit to a dataset to support a hypothesis, as in a simple linear regression. Bayesian approaches turn the paradigm around by asking the question “what is the likelihood of the data given a model?”.</p>
<p>Bayesian approaches are fundamentally linked to Bayes theorem that describes the likelihood of observing an event as depending on the likelihood that other events have occurred. In model speak, this means we can estimate the posterior distribution of a parameter given a prior distribution. For EBASE, we can establish a set of prior distributions of likely values for each of the unknown parameters, <span class="math inline">\(a\)</span>, <span class="math inline">\(R\)</span>, and <span class="math inline">\(b\)</span>. These prior distributions are used to create a refined estimate for the posterior distributions given the data that is presented to the model. The prior distributions can be precise (informed) or cover a range of potential values (uninformed).</p>
<p>The default prior distributions for EBASE were based on a likely range of values for each parameter that were informed by published results <span class="citation" data-cites="caffrey2004 Beck2024">(primarily <a href="references.html#ref-caffrey2004" role="doc-biblioref">Caffrey 2004</a>; details in <a href="references.html#ref-Beck2024" role="doc-biblioref">Beck et al. 2024</a>)</span>. You can create a plot of these prior distributions using the <code>prior_plot</code> function in EBASE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EBASE)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="03_ebase_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>Running EBASE with the default arguments will use these prior distributions to estimate the parameters. We’ll discuss how to change these values later in the lesson if you have additional prior information.</p>
<p>Finally, the Bayesian approach in EBASE uses an MCMC (Markov Chain Monte Carlo) method to estimate the posterior distributions. This is implemented using the <a href="https://mcmc-jags.sourceforge.io/">JAGS</a> software which was part of the installation during <a href="./setup.html#sec-instjags">setup</a> for the workshop. These methods are used to estimate the posterior distributions by repeated sampling of the priors given the data until a stable estimate is reached (i.e., convergence) using a Markov Chain. Because of this, estimation can take a while and we’ll talk about arguments in EBASE to control the process.</p>
</section>
<section id="ebase-minimal-example" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="ebase-minimal-example"><span class="header-section-number">3.5</span> EBASE minimal example</h2>
<p>Below is a minimal example of how to use EBASE with the example dataset provided in the package. We’ll subset only a few days so that we can run the example in real time. Some helper functions from dplyr are used to subset the data before using EBASE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dates to subset</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="fu">c</span>(<span class="st">"2012-06-01 00:00:00"</span>, <span class="st">"2012-06-05 00:00:00"</span>), <span class="at">tz =</span> <span class="st">'America/Jamaica'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># subset exdat</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> exdat <span class="sc">|&gt;</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DateTimeStamp <span class="sc">&gt;=</span> dts[<span class="dv">1</span>] <span class="sc">&amp;</span> DateTimeStamp <span class="sc">&lt;=</span> dts[<span class="dv">2</span>])</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        DateTimeStamp DO_obs Temp  Sal PAR WSpd
1 2012-06-01 00:00:00    4.5 29.5 23.0   0  2.0
2 2012-06-01 00:15:00    5.1 29.5 23.3   0  2.3
3 2012-06-01 00:30:00    4.8 29.5 23.4   0  2.1
4 2012-06-01 00:45:00    4.8 29.5 23.3   0  2.0
5 2012-06-01 01:00:00    4.8 29.5 23.1   0  1.7
6 2012-06-01 01:15:00    5.0 29.5 24.0   0  1.8</code></pre>
</div>
</div>
<p>Now we run EBASE using the data subset and the default arguments. We must supply values for the <code>interval</code> argument that defines the time step of the data seconds and the water column depth <code>Z</code> in meters, which we can get from metadata.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run ebase</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">ebase</span>(dat, <span class="at">interval =</span> <span class="dv">900</span>, <span class="at">Z =</span> <span class="fl">1.85</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        DateTimeStamp       Date grp    Z  DO_obs   DO_mod DO_modlo DO_modhi
1 2012-06-01 00:00:00 2012-06-01   1 1.85 140.625 166.1133 166.1113 166.1152
2 2012-06-01 00:15:00 2012-06-01   1 1.85 159.375 165.4166 165.1557 165.6798
3 2012-06-01 00:30:00 2012-06-01   1 1.85 150.000 164.7517 164.2320 165.2779
4 2012-06-01 00:45:00 2012-06-01   1 1.85 150.000 164.0669 163.2892 164.8548
5 2012-06-01 01:00:00 2012-06-01   1 1.85 150.000 163.3739 162.3401 164.4216
6 2012-06-01 01:15:00 2012-06-01   1 1.85 156.250 162.6550 161.3612 163.9626
        dDO converge       rsq         a       alo      ahi         b
1        NA     Fine 0.3316127        NA        NA       NA        NA
2 -66.87898     Fine 0.3316127 0.8907139 0.5510422 1.219913 0.3072874
3 -63.83456     Fine 0.3316127 0.8907139 0.5510422 1.219913 0.3072874
4 -65.73723     Fine 0.3316127 0.8907139 0.5510422 1.219913 0.3072874
5 -66.52363     Fine 0.3316127 0.8907139 0.5510422 1.219913 0.3072874
6 -69.01844     Fine 0.3316127 0.8907139 0.5510422 1.219913 0.3072874
         blo       bhi  P Plo Phi        R      Rlo      Rhi        D      Dlo
1         NA        NA NA  NA  NA       NA       NA       NA       NA       NA
2 0.08905189 0.4851563  0   0   0 140.6563 91.67931 188.0892 16.93020 4.906344
3 0.08905189 0.4851563  0   0   0 140.6563 91.67931 188.0892 22.56238 6.545028
4 0.08905189 0.4851563  0   0   0 140.6563 91.67931 188.0892 19.04245 5.516245
5 0.08905189 0.4851563  0   0   0 140.6563 91.67931 188.0892 17.58760 5.084106
6 0.08905189 0.4851563  0   0   0 140.6563 91.67931 188.0892 12.97221 3.741553
       Dhi
1       NA
2 26.73034
3 35.67040
4 30.14563
5 27.83969
6 20.56160</code></pre>
</div>
</div>
<p>The results are returned as a data frame with instantaneous metabolic estimates for areal gross production (O2 mmol m<span class="math inline">\(^{-2}\)</span> d<span class="math inline">\(^{-1}\)</span>, <code>P</code>), respiration (O2 mmol m<span class="math inline">\(^{-2}\)</span> d<span class="math inline">\(^{-1}\)</span>, <code>R</code>), and gas exchange (O2 mmol m<span class="math inline">\(^{-2}\)</span> d<span class="math inline">\(^{-1}\)</span>, <code>D</code> or the remainder of the equation from above, positive values as ingassing, negative values as outgassing).</p>
<p>Additional parameters estimated by the model that are returned include <code>a</code> as (mmol O<span class="math inline">\(_2\)</span> m<span class="math inline">\(^{-2}\)</span> d<span class="math inline">\(^{-1}\)</span>)/(W m<span class="math inline">\(^{-2}\)</span>) and <code>b</code> as (cm h<span class="math inline">\(^{-1}\)</span>)/(m<span class="math inline">\(^2\)</span> s<span class="math inline">\(^{-2}\)</span>). We also see modelled DO as <code>DO_mod</code> and various convergence metrics. The upper and lower credible intervals for each estimated parameter are also provided by <code>lo</code> or <code>hi</code> suffixes, which we’ll describe later to assess model fit.</p>
</section>
<section id="ebase-full-example" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="ebase-full-example"><span class="header-section-number">3.6</span> EBASE full example</h2>
<p>Next we’ll use EBASE to estimate metabolism using the dataset from <a href="02_dataprep.html" class="quarto-xref">Lesson&nbsp;<span>2</span></a>. First, the dataset is loaded into your workspace.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">'data/apadb.RData'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As with the example dataset, we’ll subset a few days so we can run the example in real time. We’ll use one week of data in July.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dates to subset</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="fu">c</span>(<span class="st">"2017-03-07 00:00:00"</span>, <span class="st">"2017-03-14 00:00:00"</span>), <span class="at">tz =</span> <span class="st">'America/Jamaica'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># subset apadb</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>apadbsub <span class="ot">&lt;-</span> apadb <span class="sc">|&gt;</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DateTimeStamp <span class="sc">&gt;=</span> dts[<span class="dv">1</span>] <span class="sc">&amp;</span> DateTimeStamp <span class="sc">&lt;=</span> dts[<span class="dv">2</span>])</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(apadbsub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        DateTimeStamp DO_obs Temp  Sal PAR WSpd Depth
1 2017-03-07 00:00:00    8.6 18.6 11.0   0  3.4  1.78
2 2017-03-07 01:00:00    8.9 18.7 10.3   0  6.1  1.73
3 2017-03-07 02:00:00    8.7 18.6 11.8   0  6.2  1.64
4 2017-03-07 03:00:00    8.8 18.5 10.1   0  6.4  1.56
5 2017-03-07 04:00:00    8.4 18.4  9.3   0  5.8  1.47
6 2017-03-07 05:00:00    8.7 18.5  9.1   0  5.1  1.41</code></pre>
</div>
</div>
<p>Now we run EBASE as before, although we have to specify different values for the <code>interval</code> and <code>Z</code> arguments. Because we combined the data at a 60 minute time step, we can use <code>interval = 3600</code>. The water column depth can be estimated from the data. We’ll also add a small amount to it because the pressure sensor is typically offset from the bottom.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get depth</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>zval <span class="ot">&lt;-</span> <span class="fu">mean</span>(apadbsub<span class="sc">$</span>Depth, <span class="at">na.rm =</span> T) <span class="sc">+</span> <span class="fl">0.3</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># run ebase</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">ebase</span>(apadbsub, <span class="at">interval =</span> <span class="dv">3600</span>, <span class="at">Z =</span> zval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Incomplete daily observations removed at end of dat</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: More than one time step or missing values will be interpolated</code></pre>
</div>
</div>
<p>First off, we got a few warnings in the console telling us some information about our dataset. Both of these warnings indicate the default behavior for EBASE when incomplete daily observations at the start or end of the dataset are present and if missing observations are found. As the warnings indicate, the “dangling” observations are removed since it is impossible to estimate metabolism accurately for these data. Missing data in the middle of the time series are also interpolated and these can be handled differently depending on the user’s preference. We’ll describe more about this in <a href="#sec-missing" class="quarto-xref"><span>Section 3.11</span></a>.</p>
<p>We’ll use some additional functions in EBASE to interpret the results. A plot of the results can be made with <code>ebase_plot()</code>. This plot shows <span class="math inline">\(P\)</span>, <span class="math inline">\(R\)</span>, and <span class="math inline">\(D\)</span> as instantaneous values at the same time step as the original dataset. Note that a single value for <span class="math inline">\(R\)</span> is returned each day. The model assumes respiration is constant for each period of time the model is estimated. This is called the “optimization period” and it is set as 1 day by default. The <code>grp</code> column in the model output indicates which optimization period applies to each observation. We’ll talk more about how and why you might change this value in <a href="#sec-optimization" class="quarto-xref"><span>Section 3.9</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ebase_plot</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="03_ebase_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>The daily averages can also be plotted by using <code>instantaneous = FALSE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ebase_plot</span>(res, <span class="at">instantaneous =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="03_ebase_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>Note that <span class="math inline">\(NEM\)</span> is not returned by <code>ebase</code>, nor is it included in the plots. We can easily calculate <span class="math inline">\(NEM\)</span> by subtracting <span class="math inline">\(R\)</span> from <span class="math inline">\(P\)</span> and use the ggplot2 package to plot the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate NEM</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> res <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">NEM =</span> P <span class="sc">-</span> R</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res, <span class="fu">aes</span>(<span class="at">x =</span> DateTimeStamp, <span class="at">y =</span> NEM)) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'NEM (mmol O2 m-2 d-1)'</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="03_ebase_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>Or we can average NEM each day and plot it again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate daily NEM</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>nemdly <span class="ot">&lt;-</span> res <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">NEM =</span> <span class="fu">mean</span>(NEM, <span class="at">na.rm =</span> T), </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> Date</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot daily NEM</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nemdly, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> NEM)) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">'NEM (mmol O2 m-2 d-1)'</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="03_ebase_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="assess-model-fit" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="assess-model-fit"><span class="header-section-number">3.7</span> Assess model fit</h2>
<p>Model fit can be assessed using the <code>converge</code> and <code>rsq</code> columns from the returned results. The values in these columns apply to each group in the <code>grp</code> column as specified with the <code>ndays</code> argument. The <code>converge</code> column indicates <code>"Check convergence"</code> or <code>"Fine"</code> if the JAGS estimate converged at that iteration or optimization period (repeated across rows for the group). Similarly, the <code>rsq</code> column shows the r-squared values of the linear fit between the modeled and observed dissolved oxygen (repeated across rows for the group).</p>
<p>The model fit can also be assessed by comparing the observed and modeled values for dissolved oxygen with the <code>fit_plot()</code> function. Estimated values are shown as lines and observed values are shown as points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="03_ebase_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>The comparison can also be separated by group with <code>bygroup = TRUE</code> based on the value for the <code>ndays</code> argument passed to <code>ebase()</code>, default as 1 day. The r-squared value of the fit between modeled and observed dissolved oxygen is also shown in the facet label for the group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(res, <span class="at">bygroup =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="03_ebase_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>A scatterplot showing modeled versus observed dissolved oxygen can also be returned by setting <code>scatter = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(res, <span class="at">bygroup =</span> <span class="cn">TRUE</span>, <span class="at">scatter =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="03_ebase_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>95% credible intervals for <code>a</code>, <code>R</code>, and <code>b</code> are also returned with the output from <code>ebase()</code> in the corresponding columns <code>alo</code>, <code>ahi</code>, <code>blo</code>, <code>bhi</code>, <code>Rlo</code>, and <code>Rhi</code>, for the 2.5th and 97.5th percentile estimates for each parameter, respectively. These values indicate the interval within which there is a 95% probability that the true parameter is in this range and is a representation of the posterior distributions for each parameter.</p>
<p>The credible intervals can be plotted with the <code>credible_plot()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">credible_plot</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="03_ebase_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>The credible intervals can also be retrieved as a data frame using <code>credible_prep()</code>. This function is provided as a convenience to parse the results from <code>ebase()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">credible_prep</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 6
# Groups:   grp [7]
   Date         grp var      mean      lo      hi
   &lt;date&gt;     &lt;dbl&gt; &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 2017-03-07     1 a       0.623  0.229    1.10 
 2 2017-03-07     1 R      64.2   17.4    117.   
 3 2017-03-07     1 b       0.249  0.0448   0.450
 4 2017-03-08     2 a       0.869  0.321    1.59 
 5 2017-03-08     2 R      30.6    2.17    71.6  
 6 2017-03-08     2 b       0.259  0.0368   0.471
 7 2017-03-09     3 a       1.78   1.23     2.38 
 8 2017-03-09     3 R     133.    76.6    194.   
 9 2017-03-09     3 b       0.328  0.117    0.488
10 2017-03-10     4 a       0.348  0.0257   0.883
# ℹ 11 more rows</code></pre>
</div>
</div>
</section>
<section id="using-ebase-with-long-time-series" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="using-ebase-with-long-time-series"><span class="header-section-number">3.8</span> Using EBASE with long time series</h2>
<p>Execution time of the model can also be reduced by using multiple processors. This is done using the <a href="https://cran.r-project.org/package=doParallel">doParrallel</a> package and creating a parallel backend as below. It doesn’t really help us when the time series is short, but it can be useful when running more than a few days of data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setup parallel backend</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ncores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">2</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(ncores)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">ebase</span>(apadb, <span class="at">interval =</span> <span class="dv">3600</span>, <span class="at">Z =</span> zval)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, although <code>ebase()</code> can be used to estimate metabolism for time series with several years of data, the <code>ebase_years()</code> function can be used to estimate results sequentially for each year. This is useful because model estimation using <code>ebase_years()</code> will continue after a year fails, e.g., when some years have long periods of missing or erroneous data. This eliminates the need to restart the model or further pre-process the data. The same arguments for <code>ebase()</code> are used for <code>ebase_years()</code>. Progress is printed directly in the console and the user can specify the number of attempts for failed years before proceeding to the following year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">ebase_years</span>(apadb, <span class="at">Z =</span> zval, <span class="at">interval =</span> <span class="dv">3600</span>, <span class="at">ncores =</span> ncores, <span class="at">quiet =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-optimization" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="sec-optimization"><span class="header-section-number">3.9</span> Equation optimization length</h2>
<p>The <code>ndays</code> argument in <code>ebase()</code> defines the model optimization period as the number of days that are used for fitting the model. By default, this is done each day, i.e., <code>ndays = 1</code>. Individual parameter estimates for <code>a</code>, <code>R</code>, and <code>b</code> are then returned for each day. However, more days can be used to estimate the unknown parameters - one day may not provide enough data to the model to create a reliable estimate.</p>
<p>Here, the number of days used to optimize the equation is set to all days in the input data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">ebase</span>(apadbsub, <span class="at">interval =</span> <span class="dv">3600</span>, <span class="at">Z =</span> zval, <span class="at">ndays =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And the resulting plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ebase_plot</span>(res, <span class="at">instantaneous =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-19-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="03_ebase_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>And the fit of observed and modeled dissolved oxygen (note the unbroken line for all days estimated together):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-20-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="03_ebase_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>Choosing the number of days to optimize the equation is a user choice based on questions of interest for the dataset. Typically, using one day for optimization may not provide enough data to meaningfully describe metabolism, although this may be the only option for very short time series. Longer optimization periods can be used for longer time series, but key events driving metabolism may be missed if the optimization period is too long, e.g., monthly.</p>
</section>
<section id="starting-value" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="starting-value"><span class="header-section-number">3.10</span> Starting value</h2>
<p>The <code>doave</code> argument can be used to define which dissolved oxygen value is used as the starting point in the Bayesian estimation for the optimization period. The default setting (<code>doave = TRUE</code>) will use the average of all the dissolved oxygen values in the optimization period defined by <code>ndays</code>. Conversely, the first dissolved oxygen observation of the time series in the optimization period will be used as the starting point if <code>doave = F</code>.</p>
<p>Below, <code>doave = FALSE</code> is used to set the first observed dissolved oxygen as the starting value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">ebase</span>(apadbsub, <span class="at">interval =</span> <span class="dv">3600</span>, <span class="at">Z =</span> zval, <span class="at">doave =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-22-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="03_ebase_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-missing" class="level2" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="sec-missing"><span class="header-section-number">3.11</span> Missing values</h2>
<p>Missing values in the input data are interpolated by <code>ebase</code> prior to estimating metabolism. It is the responsibility of the user to verify that these interpolated values are not wildly inaccurate. Missing values are linearly interpolated between non-missing values at the time step specified by the value in <code>interval</code>. This works well for small gaps, but can easily create inaccurate values at gaps larger than a few hours.</p>
<p>Let’s create some missing data in our Apalachicola subset. We’ll remove a few hours on one day and remove an entire day.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>apadbmiss <span class="ot">&lt;-</span> apadbsub</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>apadbmiss<span class="sc">$</span>DO_obs[<span class="fu">c</span>(<span class="dv">57</span><span class="sc">:</span><span class="dv">61</span>, <span class="dv">97</span><span class="sc">:</span><span class="dv">120</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The interpolated values can be visually inspected using the <code>interp_plot()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interp_plot</span>(apadbmiss, <span class="at">Z =</span> zval, <span class="at">interval =</span> <span class="dv">3600</span>, <span class="at">param =</span> <span class="st">'DO_obs'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="03_ebase_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>The <code>ebase</code> function includes the <code>maxinterp</code> argument to assign <code>NA</code> values to continuously interpolated rows with length greater than the value defined by <code>maxinterp</code>. This value is set to 12 hours by default and applies to the groupings defined by <code>ndays</code>, i.e., any group with a continuous set of interpolated values where the time is greater than 12 hours are assigned <code>NA</code> (except <code>Date</code> and <code>DateTimeStamp</code>). The numeric value passed to <code>maxinterp</code> is the number of time steps for the input data.</p>
<p>Running <code>ebase</code> on the time series with missing data shows how the interpolatd data are handled. Note that results for the long gap are removed, whereas those for the shorter gaps are retained.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">ebase</span>(apadbmiss, <span class="at">interval =</span> <span class="dv">3600</span>, <span class="at">Z =</span> zval)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ebase_plot</span>(res, <span class="at">instantaneous =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="03_ebase_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="changing-priors" class="level2" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="changing-priors"><span class="header-section-number">3.12</span> Changing priors</h2>
<p>A main advantage of the Bayesian approach is the use of prior information to estimate parameters. By default, the prior distributions for the <span class="math inline">\(a\)</span>, <span class="math inline">\(R\)</span>, and <span class="math inline">\(b\)</span> parameters are informed by the literature, although they are generally uninformed by allowing a large range of values to be considered given the data. We can further constrain the parameters if we have reason to do so.</p>
<p>Here, the prior distribution for the <span class="math inline">\(b\)</span> parameter is fixed to 0.251 (cm h<span class="math inline">\(^{-1}\)</span>)/(m<span class="math inline">\(^2\)</span> s<span class="math inline">\(^{-2}\)</span>), as suggested by <span class="citation" data-cites="Wanninkhof2024">(<a href="references.html#ref-Wanninkhof2024" role="doc-biblioref"><strong>Wanninkhof2024?</strong></a>)</span>. We can view this change with the <code>prior_plot</code> function before using <code>ebase</code>. Note that we define the mean as our desired value and assign a very small range for the standard deviation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_plot</span>(<span class="at">bprior =</span> <span class="fu">c</span>(<span class="fl">0.251</span>, <span class="fl">1e-6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="03_ebase_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>The same change to the prior distribution for the <span class="math inline">\(b\)</span> parameter is applied to <code>ebase</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">ebase</span>(apadbsub, <span class="at">interval =</span> <span class="dv">3600</span>, <span class="at">Z =</span> zval, <span class="at">bprior =</span> <span class="fu">c</span>(<span class="fl">0.251</span>, <span class="fl">1e-6</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ebase_plot</span>(res, <span class="at">instantaneous =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="03_ebase_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
<p>The <code>credible_plot</code> function can be used to assess how changing the prior distributions has an influence on the posterior distributions of the parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">credible_plot</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="03_ebase_files/figure-html/unnamed-chunk-28-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="03_ebase_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="next-steps" class="level2" data-number="3.13">
<h2 data-number="3.13" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">3.13</span> Next steps</h2>
<p>You now understand the basics of ecosystem metabolism with EBASE and how it estimates key parameters using a Bayesian approach. We’ve explored additional functions in EBASE to help interpret the results, which include an evaluation of goodness of fit and various plotting methods. Next, we’ll explore the EBASE results in more detail to demonstrate how the results can inform the understanding of ecosystem health and function.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Beck2024" class="csl-entry" role="listitem">
Beck, M. W., J. M. Arriola, M. Herrmann, and R. G. Najjar. 2024. Fitting metabolic models to dissolved oxygen data: The estuarine bayesian single-station estimation method. Limnology and Oceanography: Methods <strong>22</strong>: 590–607. doi:<a href="https://doi.org/10.1002/lom3.10620">10.1002/lom3.10620</a>
</div>
<div id="ref-caffrey2004" class="csl-entry" role="listitem">
Caffrey, J. M. 2004. Factors controlling net ecosystem metabolism in U.S. estuaries. Estuaries <strong>27</strong>: 90–101. doi:<a href="https://doi.org/10.1007/bf02803563">10.1007/bf02803563</a>
</div>
<div id="ref-Odum56" class="csl-entry" role="listitem">
Odum, H. T. 1956. Primary production in flowing waters. Limnology and Oceanography <strong>1</strong>: 102–117.
</div>
<div id="ref-Wanninkhof14" class="csl-entry" role="listitem">
Wanninkhof, R. 2014. Relationship between wind speed and gas exchange over the ocean revisited. Limnology and Oceanography: Methods <strong>12</strong>: 351–362. doi:<a href="https://doi.org/10.4319/lom.2014.12.351">10.4319/lom.2014.12.351</a>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02_dataprep.html" class="pagination-link" aria-label="Data Preparation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Preparation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04_interpret.html" class="pagination-link" aria-label="Interpreting Results">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Interpreting Results</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Website created by the instructor, with attribution to external content</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/fawda123/ebase-training/edit/main/03_ebase.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/" target="_blank">Quarto</a></p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","closeEffect":"zoom","selector":".lightbox","loop":false,"openEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>